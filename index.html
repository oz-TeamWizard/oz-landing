<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mealStack - 맞춤형 단백질 계산기</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-red: #dc2626;
        --dark-bg: #1a1a1a;
        --card-bg: #2d2d2d;
        --text-light: #f8f9fa;
        --border-color: #404040;
      }

      body {
        background: linear-gradient(135deg, var(--dark-bg) 0%, #0f0f0f 100%);
        color: var(--text-light);
        font-family: "Arial", sans-serif;
        min-height: 100vh;
      }

      .navbar {
        background: rgba(26, 26, 26, 0.95) !important;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
      }

      .brand-logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-red) !important;
        text-shadow: 0 0 10px rgba(220, 38, 38, 0.3);
      }

      .hero-section {
        padding: 80px 0;
        text-align: center;
      }

      .hero-title {
        font-size: 3.5rem;
        font-weight: 900;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, var(--primary-red), #ff4d4d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-subtitle {
        font-size: 1.2rem;
        color: #cccccc;
        margin-bottom: 2rem;
      }

      .input-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .form-control,
      .form-select {
        background: #1a1a1a;
        border: 2px solid var(--border-color);
        color: var(--text-light);
        border-radius: 10px;
        padding: 12px 16px;
      }

      .form-control:focus,
      .form-select:focus {
        background: #1a1a1a;
        border-color: var(--primary-red);
        color: var(--text-light);
        box-shadow: 0 0 0 0.25rem rgba(220, 38, 38, 0.25);
      }

      .btn-primary {
        background: linear-gradient(45deg, var(--primary-red), #ff4d4d);
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(220, 38, 38, 0.4);
        background: linear-gradient(45deg, #b91c1c, var(--primary-red));
      }

      .result-card {
        background: linear-gradient(135deg, var(--primary-red), #b91c1c);
        border-radius: 20px;
        padding: 3rem 2rem;
        text-align: center;
        margin: 2rem 0;
        box-shadow: 0 15px 35px rgba(220, 38, 38, 0.3);
        display: none;
      }

      .protein-amount {
        font-size: 4rem;
        font-weight: 900;
        color: white;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        margin-bottom: 0.5rem;
      }

      .protein-label {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.9);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .meal-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
      }

      .meal-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        border-color: var(--primary-red);
      }

      .meal-title {
        color: var(--primary-red);
        font-weight: bold;
        font-size: 1.3rem;
        margin-bottom: 1rem;
      }

      .food-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
      }

      .food-item:last-child {
        border-bottom: none;
      }

      .protein-badge {
        background: var(--primary-red);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .section-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        margin: 4rem 0 2rem 0;
        color: var(--primary-red);
      }

      .loading {
        display: none;
        text-align: center;
        color: var(--primary-red);
      }

      .language-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      /* Subscription Section Styles */
      .subscription-card {
        background: rgba(45, 45, 45, 0.5);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2.5rem;
        margin-top: 4rem;
        text-align: center;
      }
      .subscription-title {
        font-size: 2rem;
        font-weight: bold;
        color: var(--text-light);
        margin-bottom: 1rem;
      }
      .subscription-subtitle {
        color: #cccccc;
        margin-bottom: 2rem;
      }
      .sns-buttons .btn {
        margin: 0 0.5rem;
        font-size: 1.5rem;
        color: #ccc;
        transition: all 0.3s ease;
      }
      .sns-buttons .btn:hover {
        color: var(--primary-red);
        transform: scale(1.1);
      }
      #subscriptionSuccessMessage {
        display: none;
        color: #28a745;
        font-weight: bold;
        margin-top: 1rem;
      }

      @media (max-width: 768px) {
        .hero-title {
          font-size: 2.5rem;
        }
        .protein-amount {
          font-size: 3rem;
        }
        .input-card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Language Toggle -->
    <div class="language-toggle">
      <button class="btn btn-outline-light btn-sm" onclick="switchLanguage()">
        <i class="fas fa-globe"></i> EN
      </button>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a class="navbar-brand brand-logo" href="#">
          <i class="fas fa-dumbbell"></i> mealStack
        </a>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <h1 class="hero-title">맞춤형 단백질 계산기</h1>
        <p class="hero-subtitle">
          당신의 체형 목표에 맞는 완벽한 단백질 섭취량과 식단을 제공합니다
        </p>
      </div>
    </section>

    <!-- Input Section -->
    <section class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="input-card">
            <h3 class="text-center mb-4">
              <i class="fas fa-calculator text-danger"></i> 계산 시작하기
            </h3>

            <form id="proteinForm">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">몸무게 (kg)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="weight"
                    min="40"
                    max="150"
                    placeholder="70"
                    required
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">체형 목표</label>
                  <select class="form-select" id="goal" required>
                    <option value="">선택하세요</option>
                    <option value="bulkup">벌크업 (근육 증가)</option>
                    <option value="lean_bulkup">린벌크업 (깔끔한 증량)</option>
                    <option value="cutting">컷팅 (체지방 감소)</option>
                    <option value="maintain">유지 (현상 유지)</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">활동 수준</label>
                  <select class="form-select" id="activity" required>
                    <option value="">선택하세요</option>
                    <option value="low">낮음 (주 3회 이하)</option>
                    <option value="moderate">보통 (주 4-5회)</option>
                    <option value="high">높음 (주 6회 이상)</option>
                  </select>
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-bolt"></i> 단백질량 계산하기
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Loading -->
    <div class="container">
      <div class="loading" id="loading">
        <i class="fas fa-spinner fa-spin fa-3x text-danger"></i>
        <p class="mt-3">최적의 식단을 계산 중입니다...</p>
      </div>
    </div>

    <!-- Result Section -->
    <section class="container">
      <div id="resultSection" style="display: none">
        <div class="result-card">
          <div class="protein-amount" id="proteinAmount">0</div>
          <div class="protein-label">일일 권장 단백질</div>
          <p class="mt-3 mb-0" id="goalDescription"></p>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="input-card">
              <h5><i class="fas fa-chart-pie text-danger"></i> 영양소 분배</h5>
              <div id="nutritionBreakdown"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-card">
              <h5>
                <i class="fas fa-clock text-danger"></i> 식사별 단백질 배분
              </h5>
              <div id="mealBreakdown"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Meal Plans Section -->
    <section class="container" id="mealPlansSection" style="display: none">
      <h2 class="section-title"><i class="fas fa-utensils"></i> 추천 식단</h2>
      <div id="mealPlans"></div>
    </section>

    <!-- Protein Chart Section -->
    <section class="container" id="proteinChartSection" style="display: none">
      <h2 class="section-title">
        <i class="fas fa-chart-bar"></i> 고단백 식품 가이드
      </h2>
      <div class="row" id="proteinChart"></div>
    </section>

    <!-- Subscription Section -->
    <section class="container" id="subscriptionSection">
      <div class="subscription-card">
        <h2 class="subscription-title">
          <i class="fas fa-envelope-open-text text-danger"></i> 나만의 식단
          플랜, 정기적으로 받아보기
        </h2>
        <p class="subscription-subtitle">
          이메일을 구독하고 방금 계산한 맞춤 결과를 즉시 받아보세요.
        </p>
        <div class="row justify-content-center">
          <div class="col-lg-7">
            <form id="subscriptionForm">
              <div class="input-group mb-3">
                <input
                  type="email"
                  class="form-control"
                  id="emailInput"
                  placeholder="your-email@example.com"
                  required
                />
                <button class="btn btn-primary" type="submit" id="submitButton">
                  <i class="fas fa-paper-plane"></i> 내 결과 이메일로 받기
                </button>
              </div>
            </form>
            <div id="subscriptionSuccessMessage">
              <i class="fas fa-check-circle"></i> 구독이 완료되었습니다! 결과가 메일로 발송되었습니다.
            </div>
          </div>
        </div>
        <hr class="my-4" style="border-color: var(--border-color)" />
        <p class="subscription-subtitle">또는 SNS 채널을 팔로우하세요!</p>
        <div class="sns-buttons">
          <a href="#" class="btn" aria-label="KakaoTalk Channel"
            ><i class="fas fa-comment"></i
          ></a>
          <a href="#" class="btn" aria-label="Instagram"
            ><i class="fab fa-instagram"></i
          ></a>
          <a href="#" class="btn" aria-label="YouTube"
            ><i class="fab fa-youtube"></i
          ></a>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer
      class="text-center py-5 mt-5"
      style="border-top: 1px solid var(--border-color)"
    >
      <div class="container">
        <p class="text-muted">
          © 2025 mealStack. 건강한 단백질 라이프를 시작하세요.
        </p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // 계산 결과를 저장할 전역 변수
        let lastCalculationResult = null;

        // Data
        const proteinCoefficients = {
          bulkup: {
            recommended: 2.2,
            description: "근육량 증가를 위한 고단백 식단",
          },
          lean_bulkup: {
            recommended: 2.0,
            description: "체지방 증가 최소화하며 근육량 증가",
          },
          cutting: {
            recommended: 2.5,
            description: "근육량 보존하며 체지방 감소",
          },
          maintain: { recommended: 1.8, description: "현재 체형 유지" },
        };

        const activityMultipliers = {
          low: 1.0,
          moderate: 1.1,
          high: 1.2,
        };

        const mealDistribution = {
          아침: 0.25,
          점심: 0.3,
          저녁: 0.3,
          간식: 0.15,
        };

        const mealTemplates = {
          bulkup: {
            breakfast: {
              name: "고단백 아침식사",
              foods: [
                { name: "계란", amount: "3개", protein: 19.5 },
                { name: "귀리", amount: "60g", protein: 10.1 },
                { name: "우유", amount: "250ml", protein: 8.5 },
              ],
            },
            lunch: {
              name: "벌크업 점심",
              foods: [
                { name: "닭가슴살", amount: "200g", protein: 62.0 },
                { name: "현미", amount: "100g", protein: 7.9 },
                { name: "브로콜리", amount: "100g", protein: 2.8 },
              ],
            },
            dinner: {
              name: "벌크업 저녁",
              foods: [
                { name: "연어", amount: "180g", protein: 45.0 },
                { name: "고구마", amount: "150g", protein: 3.0 },
                { name: "시금치", amount: "100g", protein: 2.9 },
              ],
            },
            snack: {
              name: "벌크업 간식",
              foods: [
                { name: "웨이 프로틴", amount: "30g", protein: 24.0 },
                { name: "바나나", amount: "1개", protein: 1.1 },
              ],
            },
          },
          lean_bulkup: {
            breakfast: {
              name: "린벌크업 아침",
              foods: [
                { name: "계란흰자", amount: "4개", protein: 14.0 },
                { name: "오트밀", amount: "50g", protein: 8.5 },
              ],
            },
            lunch: {
              name: "린벌크업 점심",
              foods: [
                { name: "닭가슴살", amount: "180g", protein: 55.8 },
                { name: "현미", amount: "70g", protein: 5.5 },
                { name: "채소", amount: "150g", protein: 3.0 },
              ],
            },
            dinner: {
              name: "린벌크업 저녁",
              foods: [
                { name: "참치", amount: "150g", protein: 42.0 },
                { name: "고구마", amount: "100g", protein: 2.0 },
              ],
            },
            snack: {
              name: "린벌크업 간식",
              foods: [{ name: "웨이 프로틴", amount: "25g", protein: 20.0 }],
            },
          },
          cutting: {
            breakfast: {
              name: "컷팅 아침",
              foods: [
                { name: "계란흰자", amount: "5개", protein: 17.5 },
                { name: "시금치", amount: "100g", protein: 2.9 },
              ],
            },
            lunch: {
              name: "컷팅 점심",
              foods: [
                { name: "닭가슴살", amount: "200g", protein: 62.0 },
                { name: "샐러드", amount: "200g", protein: 4.0 },
              ],
            },
            dinner: {
              name: "컷팅 저녁",
              foods: [
                { name: "흰살생선", amount: "180g", protein: 40.0 },
                { name: "브로콜리", amount: "200g", protein: 5.6 },
              ],
            },
            snack: {
              name: "컷팅 간식",
              foods: [{ name: "카제인 프로틴", amount: "25g", protein: 19.5 }],
            },
          },
          maintain: {
            breakfast: {
              name: "유지 아침",
              foods: [
                { name: "계란", amount: "2개", protein: 13.0 },
                { name: "토스트", amount: "2장", protein: 6.0 },
              ],
            },
            lunch: {
              name: "유지 점심",
              foods: [
                { name: "닭가슴살", amount: "150g", protein: 46.5 },
                { name: "현미", amount: "80g", protein: 6.3 },
              ],
            },
            dinner: {
              name: "유지 저녁",
              foods: [
                { name: "두부", amount: "150g", protein: 12.0 },
                { name: "야채", amount: "150g", protein: 3.0 },
              ],
            },
            snack: {
              name: "유지 간식",
              foods: [{ name: "그릭요거트", amount: "150g", protein: 15.0 }],
            },
          },
        };

        const proteinFoods = [
          { name: "닭가슴살", protein: 31.0, category: "육류" },
          { name: "참치", protein: 28.0, category: "해산물" },
          { name: "계란", protein: 13.0, category: "유제품" },
          { name: "웨이 프로틴", protein: 80.0, category: "보충제" },
          { name: "두부", protein: 8.0, category: "콩류" },
          { name: "그릭요거트", protein: 10.0, category: "유제품" },
          { name: "연어", protein: 25.0, category: "해산물" },
          { name: "소고기", protein: 26.0, category: "육류" },
        ];

        // Form handling
        document
          .getElementById("proteinForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            calculateProtein();
          });

        function calculateProtein() {
          const weight = parseFloat(document.getElementById("weight").value);
          const goal = document.getElementById("goal").value;
          const activity = document.getElementById("activity").value;

          if (!weight || !goal || !activity) {
            alert("모든 필드를 입력해주세요.");
            return;
          }

          document.getElementById("loading").style.display = "block";
          document.getElementById("resultSection").style.display = "none";
          document.getElementById("mealPlansSection").style.display = "none";
          document.getElementById("proteinChartSection").style.display = "none";

          setTimeout(() => {
            const coefficient = proteinCoefficients[goal].recommended;
            const multiplier = activityMultipliers[activity];
            const totalProtein = Math.round(weight * coefficient * multiplier);

            document.getElementById("loading").style.display = "none";
            displayResults(totalProtein, goal, weight);
          }, 1500);
        }

        function displayResults(totalProtein, goal, weight) {
          lastCalculationResult = {
              protein: totalProtein,
              goal: goal,
              description: proteinCoefficients[goal].description,
          };

          document.getElementById("proteinAmount").textContent = totalProtein + "g";
          document.getElementById("goalDescription").textContent = proteinCoefficients[goal].description;

          const resultSection = document.getElementById("resultSection");
          resultSection.style.display = "block";
          resultSection.scrollIntoView({ behavior: "smooth" });

          const calories = weight * (goal === "bulkup" ? 45 : goal === "cutting" ? 28 : 35);
          document.getElementById("nutritionBreakdown").innerHTML = `
                  <div class="d-flex justify-content-between mb-2">
                      <span>일일 칼로리</span>
                      <span class="protein-badge">${Math.round(calories)}kcal</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                      <span>단백질</span>
                      <span class="protein-badge">${totalProtein}g</span>
                  </div>
                  <div class="d-flex justify-content-between">
                      <span>탄수화물</span>
                      <span class="protein-badge">${Math.round((calories * 0.4) / 4)}g</span>
                  </div>
              `;

          let mealBreakdownHtml = "";
          for (const [meal, ratio] of Object.entries(mealDistribution)) {
            const mealProtein = Math.round(totalProtein * ratio);
            mealBreakdownHtml += `
                          <div class="d-flex justify-content-between mb-2">
                              <span>${meal}</span>
                              <span class="protein-badge">${mealProtein}g</span>
                          </div>
                      `;
          }
          document.getElementById("mealBreakdown").innerHTML = mealBreakdownHtml;

          displayMealPlans(goal);
          displayProteinChart();
        }

        function displayMealPlans(goal) {
          const mealPlansSection = document.getElementById("mealPlansSection");
          const mealPlans = document.getElementById("mealPlans");
          let html = '<div class="row">';
          const meals = mealTemplates[goal];
          for (const [mealType, mealData] of Object.entries(meals)) {
            const totalProtein = mealData.foods.reduce(
              (sum, food) => sum + food.protein,
              0
            );
            html += `
                          <div class="col-md-6 mb-4">
                              <div class="meal-card">
                                  <h5 class="meal-title">${mealData.name}</h5>
                                  <div class="mb-3">
              `;
            mealData.foods.forEach((food) => {
              html += `
                                  <div class="food-item">
                                      <span>${food.name} (${food.amount})</span>
                                      <span class="protein-badge">${food.protein}g</span>
                                  </div>
                              `;
            });
            html += `
                                  </div>
                                  <div class="text-center">
                                      <strong>총 단백질: ${totalProtein.toFixed(1)}g</strong>
                                  </div>
                              </div>
                          </div>
                      `;
          }
          html += "</div>";
          mealPlans.innerHTML = html;
          mealPlansSection.style.display = "block";
        }

        function displayProteinChart() {
          const proteinChart = document.getElementById("proteinChart");
          const proteinChartSection = document.getElementById("proteinChartSection");
          let html = "";
          proteinFoods.forEach((food) => {
            html += `
                          <div class="col-md-3 col-sm-6 mb-3">
                              <div class="meal-card text-center">
                                  <h6 class="meal-title">${food.name}</h6>
                                  <div class="protein-amount" style="font-size: 1.5rem;">${food.protein}g</div>
                                  <small class="text-muted">100g당</small>
                                  <div class="mt-2">
                                      <span class="badge bg-secondary">${food.category}</span>
                                  </div>
                              </div>
                          </div>
                      `;
          });
          proteinChart.innerHTML = html;
          proteinChartSection.style.display = "block";
        }

        window.switchLanguage = function() {
          alert("영어 버전으로 전환합니다!");
        }

        // Subscription Form Handling
        document.getElementById('subscriptionForm').addEventListener('submit', function(e) {
          e.preventDefault();
          
          if (!lastCalculationResult) {
              alert('"계산 시작하기"를 먼저 해보세요.');
              return;
          }

          const email = document.getElementById('emailInput').value;
          const submitButton = document.getElementById('submitButton');
          
          if (!email) {
              alert('이메일 주소를 입력해주세요.');
              return;
          }

          submitButton.disabled = true;
          submitButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> 전송 중...`;

          const payload = {
              email: email,
              protein: lastCalculationResult.protein,
              goal: lastCalculationResult.goal,
              description: lastCalculationResult.description
          };

          const GAPS_URL = 'https://script.google.com/macros/s/AKfycbwZt76peALUjHpTBtowxnXVwBhuxL1TVRva8hSkhX1NwXcTCygG9LTdXTfbchWCUVNtpA/exec';  //<==여기에_배포된_웹_앱_URL을_붙여넣으세요 //

          if (GAPS_URL === '여기에_배포된_웹_앱_URL을_붙여넣으세요') {
              console.warn('Google Apps Script URL이 설정되지 않았습니다. 구독 기능을 테스트하기 위해 시뮬레이션 모드로 작동합니다.');
              setTimeout(() => {
                  showSubscriptionSuccess();
                  submitButton.disabled = false;
                  submitButton.innerHTML = `<i class="fas fa-paper-plane"></i> 내 결과 이메일로 받기`;
              }, 1000);
              return;
          }
          
          fetch(GAPS_URL, {
              method: 'POST',
              mode: 'no-cors', 
              cache: 'no-cache',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(payload)
          })
          .then(() => {
              showSubscriptionSuccess();
          })
          .catch(error => {
              console.error('Error:', error);
              showSubscriptionSuccess();
          })
          .finally(() => {
              submitButton.disabled = false;
              submitButton.innerHTML = `<i class="fas fa-paper-plane"></i> 내 결과 이메일로 받기`;
          });
        });

        function showSubscriptionSuccess() {
          const successMessage = document.getElementById('subscriptionSuccessMessage');
          const emailInput = document.getElementById('emailInput');
          
          successMessage.style.display = 'block';
          emailInput.value = '';

          setTimeout(() => {
              successMessage.style.display = 'none';
          }, 3000);
        }

        // Smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            const href = this.getAttribute("href");
            if (href && href.length > 1) {
              e.preventDefault();
              const targetElement = document.querySelector(href);
              if (targetElement) {
                targetElement.scrollIntoView({
                  behavior: "smooth",
                });
              }
            }
          });
        });
      });
    </script>
  </body>
</html>
