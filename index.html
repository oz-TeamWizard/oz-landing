<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mealStack - ë§ì¶¤í˜• ë‹¨ë°±ì§ˆ ê³„ì‚°ê¸°</title>
    <meta
      name="description"
      content="ë‹¹ì‹ ì˜ ì²´í˜• ëª©í‘œì— ë§ëŠ” ì™„ë²½í•œ ë‹¨ë°±ì§ˆ ì„­ì·¨ëŸ‰ê³¼ ì‹ë‹¨ì„ ì œê³µí•©ë‹ˆë‹¤. ë²Œí¬ì—…, ë¦°ë²Œí¬ì—…, ì»·íŒ…, ìœ ì§€ ëª©ì ë³„ ë§ì¶¤ ì‹ë‹¨ ê³„ì‚°ê¸°"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-red: #dc2626;
        --dark-bg: #1a1a1a;
        --card-bg: #2d2d2d;
        --text-light: #f8f9fa;
        --border-color: #404040;
      }

      body {
        background: linear-gradient(135deg, var(--dark-bg) 0%, #0f0f0f 100%);
        color: var(--text-light);
        font-family: "Arial", sans-serif;
        min-height: 100vh;
      }

      .navbar {
        background: rgba(26, 26, 26, 0.95) !important;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
      }

      .brand-logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-red) !important;
        text-shadow: 0 0 10px rgba(220, 38, 38, 0.3);
      }

      .hero-section {
        padding: 80px 0;
        text-align: center;
      }

      .hero-title {
        font-size: 3.5rem;
        font-weight: 900;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, var(--primary-red), #ff4d4d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-subtitle {
        font-size: 1.2rem;
        color: #cccccc;
        margin-bottom: 2rem;
      }

      .input-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .form-control,
      .form-select {
        background: #1a1a1a;
        border: 2px solid var(--border-color);
        color: var(--text-light);
        border-radius: 10px;
        padding: 12px 16px;
      }

      .form-control:focus,
      .form-select:focus {
        background: #1a1a1a;
        border-color: var(--primary-red);
        color: var(--text-light);
        box-shadow: 0 0 0 0.25rem rgba(220, 38, 38, 0.25);
      }

      .btn-primary {
        background: linear-gradient(45deg, var(--primary-red), #ff4d4d);
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(220, 38, 38, 0.4);
        background: linear-gradient(45deg, #b91c1c, var(--primary-red));
      }

      .result-card {
        background: linear-gradient(135deg, var(--primary-red), #b91c1c);
        border-radius: 20px;
        padding: 3rem 2rem;
        text-align: center;
        margin: 2rem 0;
        box-shadow: 0 15px 35px rgba(220, 38, 38, 0.3);
        display: none;
      }

      .protein-amount {
        font-size: 4rem;
        font-weight: 900;
        color: white;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        margin-bottom: 0.5rem;
      }

      .protein-label {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.9);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .meal-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
      }

      .meal-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        border-color: var(--primary-red);
      }

      .meal-title {
        color: var(--primary-red);
        font-weight: bold;
        font-size: 1.3rem;
        margin-bottom: 1rem;
      }

      .food-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
      }

      .food-item:last-child {
        border-bottom: none;
      }

      .protein-badge {
        background: var(--primary-red);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .section-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        margin: 4rem 0 2rem 0;
        color: var(--primary-red);
      }

      .loading {
        display: none;
        text-align: center;
        color: var(--primary-red);
      }

      .language-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      /* ë©”ì¸ ë‹¨ë°±ì§ˆ ì¹´ë“œ */
      #mainProteinCard {
        background: var(--card-bg) !important;
        border: 1.5px solid var(--border-color) !important;
        border-radius: 15px !important;
        padding: 2rem 1.5rem !important;
        margin-top: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      #mainProteinCard:hover,
      #mainProteinCard:active {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        border-color: var(--primary-red) !important;
      }
      #mainProteinCard .protein-amount {
        color: var(--primary-red) !important;
        text-shadow: 0 0 16px rgba(220, 38, 38, 0.25);
      }
      #mainProteinCard .protein-label {
        color: #fff;
        font-weight: bold;
        letter-spacing: 2px;
      }

      /* ì‹í’ˆ ì„ í˜¸ë„ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
      .preference-section {
        background: rgba(45, 45, 45, 0.5);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 1.5rem;
        margin: 1rem 0;
      }

      .preference-checkbox {
        margin: 0.3rem;
      }

      .preference-checkbox input[type="checkbox"] {
        display: none;
      }

      .preference-checkbox label {
        display: inline-block;
        background: var(--card-bg);
        color: var(--text-light);
        padding: 0.75rem 1.5rem;
        border: 2px solid var(--border-color);
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        white-space: nowrap;
      }

      .preference-checkbox input[type="checkbox"]:checked + label {
        background: var(--primary-red);
        border-color: var(--primary-red);
        color: white;
        transform: scale(1.05);
      }

      .preference-checkbox label:hover {
        border-color: var(--primary-red);
        transform: scale(1.02);
      }

      /* ìº¡ì²˜ ë²„íŠ¼ */
      .capture-section {
        text-align: center;
        margin: 2rem 0;
      }

      .btn-capture {
        background: linear-gradient(45deg, var(--primary-red), #ff4d4d);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 25px;
        font-weight: bold;
        margin: 0 0.5rem 0.5rem 0.5rem;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-capture:hover {
        background: linear-gradient(45deg, #b91c1c, var(--primary-red));
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(220, 38, 38, 0.4);
      }

      /* êµ¬ë… ì„¹ì…˜ */
      .subscription-card {
        background: rgba(45, 45, 45, 0.5);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2.5rem;
        margin-top: 4rem;
        text-align: center;
      }

      .subscription-title {
        font-size: 2rem;
        font-weight: bold;
        color: var(--text-light);
        margin-bottom: 1rem;
      }

      .subscription-subtitle {
        color: #cccccc;
        margin-bottom: 2rem;
      }

      #subscriptionSuccessMessage {
        display: none;
        color: #28a745;
        font-weight: bold;
        margin-top: 1rem;
      }

      @media (max-width: 768px) {
        .hero-title {
          font-size: 2.5rem;
        }
        .protein-amount {
          font-size: 3rem;
        }
        .input-card {
          padding: 1.5rem;
        }
        .preference-checkbox {
          margin: 0.2rem;
        }
        .preference-checkbox label {
          padding: 0.6rem 1.2rem;
          font-size: 0.9rem;
        }
        .btn-capture {
          padding: 10px 20px;
          font-size: 0.9rem;
          margin: 0.25rem;
        }
        .capture-section {
          margin: 1rem 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Language Toggle -->
    <div class="language-toggle">
      <button class="btn btn-outline-light btn-sm" onclick="switchLanguage()">
        <i class="fas fa-globe"></i> EN
      </button>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a class="navbar-brand brand-logo" href="#">
          <i class="fas fa-dumbbell"></i> mealStack
        </a>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <h1 class="hero-title">ë§ì¶¤í˜• ë‹¨ë°±ì§ˆ ê³„ì‚°ê¸°</h1>
        <p class="hero-subtitle">
          ë‹¹ì‹ ì˜ ì²´í˜• ëª©í‘œì— ë§ëŠ” ì™„ë²½í•œ ë‹¨ë°±ì§ˆ ì„­ì·¨ëŸ‰ê³¼ ì‹ë‹¨ì„ ì œê³µí•©ë‹ˆë‹¤
        </p>
      </div>
    </section>

    <!-- Input Section -->
    <section class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="input-card">
            <h3 class="text-center mb-4">
              <i class="fas fa-calculator text-danger"></i> ê³„ì‚° ì‹œì‘í•˜ê¸°
            </h3>

            <form id="proteinForm">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">ëª¸ë¬´ê²Œ (kg)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="weight"
                    min="40"
                    max="150"
                    placeholder="70"
                    required
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">ì²´í˜• ëª©í‘œ</label>
                  <select class="form-select" id="goal" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="bulkup">ë²Œí¬ì—… (ê·¼ìœ¡ ì¦ê°€)</option>
                    <option value="lean_bulkup">ë¦°ë²Œí¬ì—… (ê¹”ë”í•œ ì¦ëŸ‰)</option>
                    <option value="cutting">ì»·íŒ… (ì²´ì§€ë°© ê°ì†Œ)</option>
                    <option value="maintain">ìœ ì§€ (í˜„ìƒ ìœ ì§€)</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">í™œë™ ìˆ˜ì¤€</label>
                  <select class="form-select" id="activity" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="low">ë‚®ìŒ (ì£¼ 3íšŒ ì´í•˜)</option>
                    <option value="moderate">ë³´í†µ (ì£¼ 4-5íšŒ)</option>
                    <option value="high">ë†’ìŒ (ì£¼ 6íšŒ ì´ìƒ)</option>
                  </select>
                </div>
              </div>

              <!-- ì‹í’ˆ ì„ í˜¸ë„ ì„ íƒ -->
              <div class="preference-section">
                <h5 class="mb-3 text-center">
                  ì„ í˜¸í•˜ëŠ” ì‹í’ˆ ì¢…ë¥˜
                  <small class="text-muted d-block">(ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</small>
                </h5>
                <div class="d-flex flex-wrap justify-content-center gap-2">
                  <div class="preference-checkbox">
                    <input type="checkbox" id="meat" value="meat" checked />
                    <label for="meat">
                      <i class="fas fa-drumstick-bite"></i> ìœ¡ë¥˜
                    </label>
                  </div>
                  <div class="preference-checkbox">
                    <input
                      type="checkbox"
                      id="seafood"
                      value="seafood"
                      checked
                    />
                    <label for="seafood">
                      <i class="fas fa-fish"></i> ì–´ë¥˜/í•´ì‚°ë¬¼
                    </label>
                  </div>
                  <div class="preference-checkbox">
                    <input type="checkbox" id="plant" value="plant" checked />
                    <label for="plant">
                      <i class="fas fa-leaf"></i> ì‹ë¬¼ì„±
                    </label>
                  </div>
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-bolt"></i> ë‹¨ë°±ì§ˆ ì–‘ ê³„ì‚°í•˜ê¸°
                </button>
              </div>
            </form>
          </div>

          <!-- ë©”ì¸ ë‹¨ë°±ì§ˆ ì¹´ë“œ -->
          <div
            id="mainProteinCard"
            class="result-card"
            style="display: none; margin-top: 1.5rem"
          >
            <div class="protein-amount" id="mainProteinAmount">0</div>
            <div class="protein-label">ì¼ì¼ ê¶Œì¥ ë‹¨ë°±ì§ˆ</div>
          </div>

          <!-- ê²°ê³¼ ìº¡ì²˜ ë²„íŠ¼ -->
          <div
            class="capture-section"
            id="captureSection"
            style="display: none"
          >
            <button class="btn btn-capture" onclick="captureResult()">
              <i class="fas fa-camera"></i> ğŸ“‹ ì‹ë‹¨í‘œ ì´ë¯¸ì§€ë¡œ ì €ì¥
            </button>
            <button class="btn btn-capture" onclick="shareResult()">
              <i class="fas fa-share"></i> ê²°ê³¼ ê³µìœ í•˜ê¸°
            </button>
          </div>

          <!-- ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‹ì¬ë£Œ ìš”ì•½ ë¦¬ìŠ¤íŠ¸ -->
          <div id="ingredientSummary" style="display: none"></div>
        </div>
      </div>
    </section>

    <!-- Loading -->
    <div class="container">
      <div class="loading" id="loading">
        <i class="fas fa-spinner fa-spin fa-3x text-danger"></i>
        <p class="mt-3">ìµœì ì˜ ì‹ë‹¨ì„ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...</p>
      </div>
    </div>

    <!-- Result Section -->
    <section class="container">
      <div id="resultSection" style="display: none">
        <div class="result-card">
          <div class="protein-amount" id="proteinAmount">0</div>
          <div class="protein-label">ì¼ì¼ ê¶Œì¥ ë‹¨ë°±ì§ˆ</div>
          <p class="mt-3 mb-0" id="goalDescription"></p>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="input-card">
              <h5><i class="fas fa-chart-pie text-danger"></i> ì˜ì–‘ì†Œ ë¶„ë°°</h5>
              <div id="nutritionBreakdown"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-card">
              <h5><i class="fas fa-clock text-danger"></i> ë¼ë‹ˆë³„ ì˜ì–‘ ë°°ë¶„</h5>
              <div id="mealBreakdown"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Meal Plans Section -->
    <section class="container" id="mealPlansSection" style="display: none">
      <h2 class="section-title"><i class="fas fa-utensils"></i> ì¶”ì²œ ì‹ë‹¨</h2>
      <div id="mealPlans"></div>
    </section>

    <!-- Subscription Section -->
    <section class="container" id="subscriptionSection">
      <div class="subscription-card">
        <h2 class="subscription-title">
          <i class="fas fa-paper-plane text-danger"></i> mealStack ìì²´ ì‹ë‹¨
          íŒ¨í‚¤ì§€ ì˜ˆì•½ ì•ˆë‚´
        </h2>
        <p class="subscription-subtitle">
          ì£¼ 7~8ë§Œì›ì˜ í•˜ë£¨ 3-4ë¼ì˜ ìì²´ ë²Œí¬ì—… ì‹ë‹¨ íŒ¨í‚¤ì§€ë¥¼ ëŸ°ì¹­í•œë‹¤ë©´ ê´€ì‹¬
          ìˆìœ¼ì‹¤ê¹Œìš”?
        </p>
        <div class="row justify-content-center">
          <div class="col-lg-7">
            <form id="subscriptionForm">
              <div class="input-group mb-3">
                <input
                  type="email"
                  class="form-control"
                  id="emailInput"
                  placeholder="your-email@example.com"
                  required
                />
                <button class="btn btn-primary" type="submit" id="submitButton">
                  <i class="fas fa-bell"></i> ì˜ˆì•½ ì•ˆë‚´ ë°›ì•„ë³´ê¸°
                </button>
              </div>
            </form>
            <div id="subscriptionSuccessMessage">
              <i class="fas fa-check-circle"></i> ì˜ˆì•½ ëª…ë‹¨ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!
              ëŸ°ì¹­ ì‹œ ê°€ì¥ ë¨¼ì € ì•Œë ¤ë“œë¦´ê²Œìš”.
            </div>
          </div>
        </div>
        <hr class="my-4" style="border-color: var(--border-color)" />
        <p class="subscription-subtitle">
          ë˜ëŠ” SNS ì±„ë„ì„ íŒ”ë¡œìš°í•˜ê³  ì†Œì‹ì„ ë°›ì•„ë³´ì„¸ìš”!
        </p>
        <div class="sns-buttons">
          <a href="#" class="btn" aria-label="KakaoTalk Channel"
            ><i class="fas fa-comment"></i
          ></a>
          <a href="#" class="btn" aria-label="Instagram"
            ><i class="fab fa-instagram"></i
          ></a>
          <a href="#" class="btn" aria-label="YouTube"
            ><i class="fab fa-youtube"></i
          ></a>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer
      class="text-center py-5 mt-5"
      style="border-top: 1px solid var(--border-color)"
    >
      <div class="container">
        <p class="text-muted">
          Â© 2025 mealStack. ê±´ê°•í•œ ë‹¨ë°±ì§ˆ ë¼ì´í”„ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
        </p>
      </div>
    </footer>

    <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ (ê²°ê³¼ ìº¡ì²˜ìš©) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
        let lastCalculationResult = null;

        // ê³¼í•™ì  ê·¼ê±° ê¸°ë°˜ ì •í™•í•œ ì‹ë‹¨ ë°ì´í„°
        const scientificMealData = {
          bulkup: {
            description: "ê·¼ìœ¡ëŸ‰ ì¦ê°€ë¥¼ ìœ„í•œ ê³ ë‹¨ë°± ì‹ë‹¨",
            carbRatio: 0.6, // 60%
            proteinRatio: 0.3, // 30%
            fatRatio: 0.1, // 10%
            proteinPerKg: 2.4, // ì²´ì¤‘ x 2.2-2.7g (ì¤‘ê°„ê°’)
            calorieMultiplier: 1.15, // +15% ì¹¼ë¡œë¦¬
            meals: {
              breakfast: {
                name: "ë²Œí¬ì—… ì•„ì¹¨ (ê³ ì¹¼ë¡œë¦¬)",
                foods: [
                  {
                    name: "ê³„ë€",
                    amount: "3ê°œ",
                    protein: 19.5,
                    carb: 1.5,
                    fat: 15.0,
                  },
                  {
                    name: "í˜„ë¯¸",
                    amount: "80g",
                    protein: 6.3,
                    carb: 58.0,
                    fat: 2.2,
                  },
                  {
                    name: "ë°”ë‚˜ë‚˜",
                    amount: "1ê°œ",
                    protein: 1.1,
                    carb: 23.0,
                    fat: 0.3,
                  },
                  {
                    name: "ê²¬ê³¼ë¥˜",
                    amount: "20g",
                    protein: 4.0,
                    carb: 4.0,
                    fat: 12.0,
                  },
                ],
              },
              lunch: {
                name: "ë²Œí¬ì—… ì ì‹¬ (ë©”ì¸ ì‹ì‚¬)",
                foods: [
                  {
                    name: "ë‹­ê°€ìŠ´ì‚´",
                    amount: "200g",
                    protein: 62.0,
                    carb: 0,
                    fat: 2.0,
                  },
                  {
                    name: "í˜„ë¯¸ë°¥",
                    amount: "120g",
                    protein: 9.5,
                    carb: 87.0,
                    fat: 3.3,
                  },
                  {
                    name: "ë¸Œë¡œì½œë¦¬",
                    amount: "100g",
                    protein: 2.8,
                    carb: 7.0,
                    fat: 0.4,
                  },
                  {
                    name: "ì˜¬ë¦¬ë¸Œì˜¤ì¼",
                    amount: "10ml",
                    protein: 0,
                    carb: 0,
                    fat: 10.0,
                  },
                ],
              },
              dinner: {
                name: "ë²Œí¬ì—… ì €ë… (ë‹¨ë°±ì§ˆ ì¤‘ì‹¬)",
                foods: [
                  {
                    name: "ì—°ì–´",
                    amount: "180g",
                    protein: 45.0,
                    carb: 0,
                    fat: 24.0,
                  },
                  {
                    name: "ê³ êµ¬ë§ˆ",
                    amount: "150g",
                    protein: 3.0,
                    carb: 30.0,
                    fat: 0.2,
                  },
                  {
                    name: "ì‹œê¸ˆì¹˜",
                    amount: "100g",
                    protein: 2.9,
                    carb: 2.0,
                    fat: 0.4,
                  },
                ],
              },
              snack: {
                name: "ë²Œí¬ì—… ê°„ì‹ (ìš´ë™ í›„)",
                foods: [
                  {
                    name: "ì›¨ì´ í”„ë¡œí‹´",
                    amount: "35g",
                    protein: 28.0,
                    carb: 3.0,
                    fat: 1.5,
                  },
                  {
                    name: "ì˜¤íŠ¸ë°€",
                    amount: "40g",
                    protein: 5.4,
                    carb: 24.0,
                    fat: 2.4,
                  },
                ],
              },
            },
          },
          lean_bulkup: {
            description: "ì²´ì§€ë°© ì¦ê°€ ìµœì†Œí™”í•˜ë©° ê·¼ìœ¡ëŸ‰ ì¦ê°€",
            carbRatio: 0.5, // 50%
            proteinRatio: 0.3, // 30%
            fatRatio: 0.2, // 20%
            proteinPerKg: 2.1, // ì²´ì¤‘ x 2.0-2.2g
            calorieMultiplier: 1.08, // +8% ì¹¼ë¡œë¦¬
            meals: {
              breakfast: {
                name: "ë¦°ë²Œí¬ì—… ì•„ì¹¨ (í´ë¦°)",
                foods: [
                  {
                    name: "ê³„ë€í°ì",
                    amount: "4ê°œ",
                    protein: 14.0,
                    carb: 0.8,
                    fat: 0.2,
                  },
                  {
                    name: "í†µë°€ë¹µ",
                    amount: "2ì¥",
                    protein: 6.0,
                    carb: 24.0,
                    fat: 2.0,
                  },
                  {
                    name: "ì•„ë³´ì¹´ë„",
                    amount: "50g",
                    protein: 1.0,
                    carb: 4.0,
                    fat: 7.5,
                  },
                ],
              },
              lunch: {
                name: "ë¦°ë²Œí¬ì—… ì ì‹¬ (ê· í˜•)",
                foods: [
                  {
                    name: "ë‹­ê°€ìŠ´ì‚´",
                    amount: "180g",
                    protein: 55.8,
                    carb: 0,
                    fat: 1.8,
                  },
                  {
                    name: "í€´ë…¸ì•„",
                    amount: "70g",
                    protein: 9.9,
                    carb: 40.0,
                    fat: 4.2,
                  },
                  {
                    name: "ì±„ì†ŒìƒëŸ¬ë“œ",
                    amount: "150g",
                    protein: 3.0,
                    carb: 8.0,
                    fat: 0.3,
                  },
                  {
                    name: "ì˜¬ë¦¬ë¸Œì˜¤ì¼",
                    amount: "7ml",
                    protein: 0,
                    carb: 0,
                    fat: 7.0,
                  },
                ],
              },
              dinner: {
                name: "ë¦°ë²Œí¬ì—… ì €ë… (ê°€ë²¼ì›€)",
                foods: [
                  {
                    name: "í°ì‚´ìƒì„ ",
                    amount: "160g",
                    protein: 35.2,
                    carb: 0,
                    fat: 1.6,
                  },
                  {
                    name: "í˜„ë¯¸",
                    amount: "60g",
                    protein: 4.7,
                    carb: 43.5,
                    fat: 1.7,
                  },
                  {
                    name: "ë¸Œë¡œì½œë¦¬",
                    amount: "120g",
                    protein: 3.4,
                    carb: 8.4,
                    fat: 0.5,
                  },
                ],
              },
              snack: {
                name: "ë¦°ë²Œí¬ì—… ê°„ì‹ (ì €ì§€ë°©)",
                foods: [
                  {
                    name: "ê·¸ë¦­ìš”ê±°íŠ¸",
                    amount: "150g",
                    protein: 15.0,
                    carb: 9.0,
                    fat: 0.75,
                  },
                  {
                    name: "ë² ë¦¬ë¥˜",
                    amount: "80g",
                    protein: 0.6,
                    carb: 12.0,
                    fat: 0.2,
                  },
                ],
              },
            },
          },
          cutting: {
            description: "ê·¼ìœ¡ëŸ‰ ë³´ì¡´í•˜ë©° ì²´ì§€ë°© ê°ì†Œ",
            carbRatio: 0.4, // 40%
            proteinRatio: 0.4, // 40%
            fatRatio: 0.2, // 20%
            proteinPerKg: 2.8, // ì²´ì¤‘ x 2.5-3.3g (ì¤‘ê°„ê°’)
            calorieMultiplier: 0.85, // -15% ì¹¼ë¡œë¦¬
            meals: {
              breakfast: {
                name: "ì»·íŒ… ì•„ì¹¨ (ê³ ë‹¨ë°±)",
                foods: [
                  {
                    name: "ê³„ë€í°ì",
                    amount: "5ê°œ",
                    protein: 17.5,
                    carb: 1.0,
                    fat: 0.25,
                  },
                  {
                    name: "ì˜¤íŠ¸ë°€",
                    amount: "30g",
                    protein: 4.0,
                    carb: 18.0,
                    fat: 1.8,
                  },
                  {
                    name: "ì‹œê¸ˆì¹˜",
                    amount: "100g",
                    protein: 2.9,
                    carb: 2.0,
                    fat: 0.4,
                  },
                ],
              },
              lunch: {
                name: "ì»·íŒ… ì ì‹¬ (ì €íƒ„ìˆ˜)",
                foods: [
                  {
                    name: "ë‹­ê°€ìŠ´ì‚´",
                    amount: "200g",
                    protein: 62.0,
                    carb: 0,
                    fat: 2.0,
                  },
                  {
                    name: "í˜„ë¯¸",
                    amount: "40g",
                    protein: 3.2,
                    carb: 29.0,
                    fat: 1.1,
                  },
                  {
                    name: "ì±„ì†Œë¯¹ìŠ¤",
                    amount: "200g",
                    protein: 4.0,
                    carb: 10.0,
                    fat: 0.4,
                  },
                ],
              },
              dinner: {
                name: "ì»·íŒ… ì €ë… (ì´ˆì €ì¹¼ë¡œë¦¬)",
                foods: [
                  {
                    name: "í°ì‚´ìƒì„ ",
                    amount: "180g",
                    protein: 39.6,
                    carb: 0,
                    fat: 1.8,
                  },
                  {
                    name: "ë¸Œë¡œì½œë¦¬",
                    amount: "200g",
                    protein: 5.6,
                    carb: 14.0,
                    fat: 0.8,
                  },
                  {
                    name: "ì–‘ìƒì¶”",
                    amount: "100g",
                    protein: 1.4,
                    carb: 3.0,
                    fat: 0.2,
                  },
                ],
              },
              snack: {
                name: "ì»·íŒ… ê°„ì‹ (ë‹¨ë°±ì§ˆ ìœ„ì£¼)",
                foods: [
                  {
                    name: "ì¹´ì œì¸ í”„ë¡œí‹´",
                    amount: "30g",
                    protein: 24.0,
                    carb: 2.0,
                    fat: 1.0,
                  },
                  {
                    name: "ì…€ëŸ¬ë¦¬",
                    amount: "50g",
                    protein: 0.7,
                    carb: 1.5,
                    fat: 0.1,
                  },
                ],
              },
            },
          },
          maintain: {
            description: "í˜„ì¬ ì²´í˜• ë° ê±´ê°• ìœ ì§€",
            carbRatio: 0.5, // 50%
            proteinRatio: 0.3, // 30%
            fatRatio: 0.2, // 20%
            proteinPerKg: 1.9, // ì²´ì¤‘ x 1.8-2.0g
            calorieMultiplier: 1.0, // ìœ ì§€ ì¹¼ë¡œë¦¬
            meals: {
              breakfast: {
                name: "ìœ ì§€ ì•„ì¹¨ (ê· í˜•)",
                foods: [
                  {
                    name: "ê³„ë€",
                    amount: "2ê°œ",
                    protein: 13.0,
                    carb: 1.0,
                    fat: 10.0,
                  },
                  {
                    name: "í†µê³¡ë¬¼í† ìŠ¤íŠ¸",
                    amount: "2ì¥",
                    protein: 6.0,
                    carb: 24.0,
                    fat: 2.0,
                  },
                  {
                    name: "ì•„ëª¬ë“œ",
                    amount: "15g",
                    protein: 3.0,
                    carb: 3.0,
                    fat: 7.5,
                  },
                ],
              },
              lunch: {
                name: "ìœ ì§€ ì ì‹¬ (ì¼ë°˜)",
                foods: [
                  {
                    name: "ë‹­ê°€ìŠ´ì‚´",
                    amount: "150g",
                    protein: 46.5,
                    carb: 0,
                    fat: 1.5,
                  },
                  {
                    name: "í˜„ë¯¸ë°¥",
                    amount: "80g",
                    protein: 6.3,
                    carb: 58.0,
                    fat: 2.2,
                  },
                  {
                    name: "ê°ì¢… ë‚˜ë¬¼",
                    amount: "120g",
                    protein: 3.0,
                    carb: 8.0,
                    fat: 0.5,
                  },
                ],
              },
              dinner: {
                name: "ìœ ì§€ ì €ë… (ê°€ì •ì‹)",
                foods: [
                  {
                    name: "ë‘ë¶€",
                    amount: "150g",
                    protein: 12.0,
                    carb: 4.5,
                    fat: 6.0,
                  },
                  {
                    name: "í˜„ë¯¸ë°¥",
                    amount: "60g",
                    protein: 4.7,
                    carb: 43.5,
                    fat: 1.7,
                  },
                  {
                    name: "ë¯¸ì—­êµ­",
                    amount: "200ml",
                    protein: 2.0,
                    carb: 4.0,
                    fat: 0.5,
                  },
                ],
              },
              snack: {
                name: "ìœ ì§€ ê°„ì‹ (ê±´ê°•)",
                foods: [
                  {
                    name: "ê·¸ë¦­ìš”ê±°íŠ¸",
                    amount: "100g",
                    protein: 10.0,
                    carb: 6.0,
                    fat: 0.5,
                  },
                  {
                    name: "ì‚¬ê³¼",
                    amount: "1/2ê°œ",
                    protein: 0.3,
                    carb: 13.0,
                    fat: 0.2,
                  },
                ],
              },
            },
          },
        };

        // ì„ í˜¸ë„ë³„ ì‹ë‹¨ ë³€í˜• ì‹œìŠ¤í…œ
        function adaptMealsByPreference(baseMeals, preferences) {
          const adaptedMeals = JSON.parse(JSON.stringify(baseMeals)); // ê¹Šì€ ë³µì‚¬

          // ì„ í˜¸ë„ì— ë”°ë¥¸ ë‹¨ë°±ì§ˆ ì†ŒìŠ¤ êµì²´
          Object.keys(adaptedMeals).forEach((mealType) => {
            const meal = adaptedMeals[mealType];

            // ìœ¡ë¥˜ ì„ í˜¸ë„ê°€ ì—†ìœ¼ë©´ ë™ë¬¼ì„± ë‹¨ë°±ì§ˆì„ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ êµì²´
            if (!preferences.includes("meat")) {
              meal.foods = meal.foods.map((food) => {
                if (["ë‹­ê°€ìŠ´ì‚´", "ì†Œê³ ê¸°", "ë¼ì§€ê³ ê¸°"].includes(food.name)) {
                  if (preferences.includes("seafood")) {
                    return {
                      ...food,
                      name: "ì°¸ì¹˜",
                      protein: food.protein * 0.9,
                    };
                  } else if (preferences.includes("plant")) {
                    return {
                      ...food,
                      name: "ë‘ë¶€",
                      protein: food.protein * 0.4,
                      carb: food.carb + 4,
                    };
                  }
                }
                return food;
              });
            }

            // í•´ì‚°ë¬¼ ì„ í˜¸ë„ì— ë”°ë¥¸ ì¡°ì •
            if (preferences.includes("seafood") && mealType === "dinner") {
              meal.foods = meal.foods.map((food) => {
                if (food.name === "ë‹­ê°€ìŠ´ì‚´") {
                  return { ...food, name: "ì—°ì–´", fat: food.fat + 12 };
                }
                return food;
              });
            }

            // ì‹ë¬¼ì„± ì„ í˜¸ë„ì— ë”°ë¥¸ ì¡°ì •
            if (preferences.includes("plant")) {
              // ê°„ì‹ì„ ê²¬ê³¼ë¥˜ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½
              if (mealType === "snack") {
                meal.foods.push({
                  name: "ì•„ëª¬ë“œ",
                  amount: "20g",
                  protein: 4.0,
                  carb: 4.0,
                  fat: 10.0,
                });
              }
            }
          });

          return adaptedMeals;
        }

        // ëª©í‘œ ì¹¼ë¡œë¦¬ì— ë§ì¶° ì‹ë‹¨ ì¡°ì •í•˜ëŠ” í•¨ìˆ˜
        function adjustMealsToTargetCalories(
          baseMeals,
          targetCalories,
          targetProtein
        ) {
          // ê¸°ë³¸ ì‹ë‹¨ì˜ ì´ ì¹¼ë¡œë¦¬ ê³„ì‚°
          let baseTotalCalories = 0;
          let baseTotalProtein = 0;

          for (const mealData of Object.values(baseMeals)) {
            for (const food of mealData.foods) {
              const calories =
                food.protein * 4 + (food.carb || 0) * 4 + (food.fat || 0) * 9;
              baseTotalCalories += calories;
              baseTotalProtein += food.protein;
            }
          }

          // ëª©í‘œì™€ì˜ ë¹„ìœ¨ ê³„ì‚°
          const calorieRatio = targetCalories / baseTotalCalories;
          const proteinRatio = targetProtein / baseTotalProtein;

          // ë” ë†’ì€ ë¹„ìœ¨ ì‚¬ìš© (ì¹¼ë¡œë¦¬ì™€ ë‹¨ë°±ì§ˆ ëª¨ë‘ ë§Œì¡±)
          const adjustmentRatio = Math.max(calorieRatio, proteinRatio);

          // ë¹„ìœ¨ì´ 1.5 ì´ìƒì´ë©´ ê°„ì‹ì„ ì¶”ê°€í•˜ì—¬ ë¼ë‹ˆ ìˆ˜ ëŠ˜ë¦¬ê¸°
          if (adjustmentRatio >= 1.5) {
            return adjustMealsWithExtraSnacks(
              baseMeals,
              targetCalories,
              targetProtein
            );
          }

          // ê¸°ë³¸ ì‹ë‹¨ ì–‘ ì¡°ì ˆ
          const adjustedMeals = JSON.parse(JSON.stringify(baseMeals));

          for (const mealData of Object.values(adjustedMeals)) {
            for (const food of mealData.foods) {
              // ì–‘ ì¡°ì ˆ
              const originalAmount = parseFloat(
                food.amount.match(/\d+/)?.[0] || 100
              );
              const newAmount = Math.round(originalAmount * adjustmentRatio);
              food.amount = food.amount.replace(/\d+/, newAmount.toString());

              // ì˜ì–‘ì†Œ ì¡°ì ˆ
              food.protein =
                Math.round(food.protein * adjustmentRatio * 10) / 10;
              food.carb =
                Math.round((food.carb || 0) * adjustmentRatio * 10) / 10;
              food.fat =
                Math.round((food.fat || 0) * adjustmentRatio * 10) / 10;
            }
          }

          return adjustedMeals;
        }

        // ë¼ë‹ˆ ìˆ˜ë¥¼ ëŠ˜ë ¤ì„œ ëª©í‘œ ì¹¼ë¡œë¦¬ ë‹¬ì„±
        function adjustMealsWithExtraSnacks(
          baseMeals,
          targetCalories,
          targetProtein
        ) {
          const adjustedMeals = JSON.parse(JSON.stringify(baseMeals));

          // ê¸°ë³¸ ì‹ë‹¨ 1.2ë°° ì¦ëŸ‰
          for (const mealData of Object.values(adjustedMeals)) {
            for (const food of mealData.foods) {
              const originalAmount = parseFloat(
                food.amount.match(/\d+/)?.[0] || 100
              );
              const newAmount = Math.round(originalAmount * 1.2);
              food.amount = food.amount.replace(/\d+/, newAmount.toString());

              food.protein = Math.round(food.protein * 1.2 * 10) / 10;
              food.carb = Math.round((food.carb || 0) * 1.2 * 10) / 10;
              food.fat = Math.round((food.fat || 0) * 1.2 * 10) / 10;
            }
          }

          // í˜„ì¬ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
          let currentCalories = 0;
          for (const mealData of Object.values(adjustedMeals)) {
            for (const food of mealData.foods) {
              currentCalories +=
                food.protein * 4 + (food.carb || 0) * 4 + (food.fat || 0) * 9;
            }
          }

          // ë¶€ì¡±í•œ ì¹¼ë¡œë¦¬ë§Œí¼ ê°„ì‹ ì¶”ê°€
          const remainingCalories = targetCalories - currentCalories;

          if (remainingCalories > 300) {
            // ìš´ë™ ì „ ê°„ì‹ ì¶”ê°€
            adjustedMeals.pre_workout = {
              name: "ìš´ë™ ì „ ê°„ì‹ (ì—ë„ˆì§€ ì¶©ì „)",
              foods: [
                {
                  name: "ë°”ë‚˜ë‚˜",
                  amount: "2ê°œ",
                  protein: 2.2,
                  carb: 46.0,
                  fat: 0.6,
                },
                {
                  name: "ê¿€",
                  amount: "15ml",
                  protein: 0.1,
                  carb: 12.0,
                  fat: 0,
                },
              ],
            };
          }

          if (remainingCalories > 600) {
            // ì·¨ì¹¨ ì „ ê°„ì‹ ì¶”ê°€
            adjustedMeals.night_snack = {
              name: "ì·¨ì¹¨ ì „ ê°„ì‹ (ê·¼ìœ¡ íšŒë³µ)",
              foods: [
                {
                  name: "ì¹´ì œì¸ í”„ë¡œí‹´",
                  amount: "30g",
                  protein: 24.0,
                  carb: 2.0,
                  fat: 1.0,
                },
                {
                  name: "ì•„ëª¬ë“œ",
                  amount: "20g",
                  protein: 4.0,
                  carb: 4.0,
                  fat: 10.0,
                },
              ],
            };
          }

          return adjustedMeals;
        }

        // ì‹ë‹¨ ì´ë¦„ í•œêµ­ì–´ ë³€í™˜
        function getMealNameKorean(mealType) {
          const mealNames = {
            breakfast: "ì•„ì¹¨",
            lunch: "ì ì‹¬",
            dinner: "ì €ë…",
            snack: "ê°„ì‹",
            pre_workout: "ìš´ë™ ì „",
            night_snack: "ì·¨ì¹¨ ì „",
          };
          return mealNames[mealType] || mealType;
        }

        // ê³¼í•™ì  ì¹¼ë¡œë¦¬ ê³„ì‚° í•¨ìˆ˜ (Harris-Benedict equation)
        function calculateCalories(weight, goal, activity) {
          // í‰ê·  ì—°ë ¹ 25ì„¸, í‰ê·  í‚¤ 170cm ê°€ì • (ë” ì •í™•í•œ ê³„ì‚°ì„ ìœ„í•´ì„œëŠ” ì‚¬ìš©ì ì…ë ¥ í•„ìš”)
          const age = 25;
          const height = 170;

          // Harris-Benedict ê³µì‹ (ë‚¨ì„± ê¸°ì¤€)
          const bmr = 88.362 + 13.397 * weight + 4.799 * height - 5.677 * age;

          // í™œë™ëŸ‰ ë°°ìˆ˜
          const activityMultipliers = {
            low: 1.25,
            moderate: 1.55,
            high: 1.75,
          };

          const tdee = bmr * activityMultipliers[activity];
          const goalMultiplier = scientificMealData[goal].calorieMultiplier;

          return Math.round(tdee * goalMultiplier);
        }

        // ì •í™•í•œ ì˜ì–‘ì†Œ ê³„ì‚° í•¨ìˆ˜
        function calculateMacros(totalCalories, goal) {
          const data = scientificMealData[goal];

          const carbCalories = totalCalories * data.carbRatio;
          const proteinCalories = totalCalories * data.proteinRatio;
          const fatCalories = totalCalories * data.fatRatio;

          return {
            carbs: Math.round(carbCalories / 4), // íƒ„ìˆ˜í™”ë¬¼ 1g = 4kcal
            protein: Math.round(proteinCalories / 4), // ë‹¨ë°±ì§ˆ 1g = 4kcal
            fat: Math.round(fatCalories / 9), // ì§€ë°© 1g = 9kcal
            totalCalories: totalCalories,
          };
        }

        const mealDistribution = {
          ì•„ì¹¨: 0.25,
          ì ì‹¬: 0.3,
          ì €ë…: 0.3,
          ê°„ì‹: 0.15,
        };

        // í¼ ì œì¶œ ì´ë²¤íŠ¸
        document
          .getElementById("proteinForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            calculateProtein();
          });

        function calculateProtein() {
          const weight = parseFloat(document.getElementById("weight").value);
          const goal = document.getElementById("goal").value;
          const activity = document.getElementById("activity").value;

          if (!weight || !goal || !activity) {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }

          // ì„ í˜¸ ì‹í’ˆ ê°€ì ¸ì˜¤ê¸°
          const preferences = getSelectedPreferences();
          if (preferences.length === 0) {
            alert("ì ì–´ë„ í•˜ë‚˜ì˜ ì‹í’ˆ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
          }

          document.getElementById("loading").style.display = "block";
          document.getElementById("resultSection").style.display = "none";
          document.getElementById("mealPlansSection").style.display = "none";
          document.getElementById("mainProteinCard").style.display = "none";
          document.getElementById("captureSection").style.display = "none";

          setTimeout(() => {
            // ê³¼í•™ì  ê³„ì‚°
            const goalData = scientificMealData[goal];
            const totalProtein = Math.round(weight * goalData.proteinPerKg);
            const totalCalories = calculateCalories(weight, goal, activity);
            const macros = calculateMacros(totalCalories, goal);

            lastCalculationResult = {
              protein: totalProtein,
              goal: goal,
              preferences: preferences,
              description: goalData.description,
              calories: totalCalories,
              macros: macros,
              weight: weight,
              activity: activity,
            };

            document.getElementById("loading").style.display = "none";
            displayResults(
              totalProtein,
              goal,
              weight,
              preferences,
              totalCalories,
              macros
            );
            document.getElementById("mainProteinCard").style.display = "block";
            document.getElementById("mainProteinAmount").textContent =
              totalProtein + "g";
            document.getElementById("captureSection").style.display = "block";
          }, 1500);
        }

        function getSelectedPreferences() {
          const preferences = [];
          if (document.getElementById("meat").checked) preferences.push("meat");
          if (document.getElementById("seafood").checked)
            preferences.push("seafood");
          if (document.getElementById("plant").checked)
            preferences.push("plant");
          return preferences;
        }

        function displayResults(
          totalProtein,
          goal,
          weight,
          preferences,
          totalCalories,
          macros
        ) {
          document.getElementById("proteinAmount").textContent =
            totalProtein + "g";
          document.getElementById("goalDescription").textContent =
            scientificMealData[goal].description;

          const resultSection = document.getElementById("resultSection");
          resultSection.style.display = "block";
          resultSection.scrollIntoView({ behavior: "smooth" });

          // ê³¼í•™ì  ì˜ì–‘ì†Œ ë¶„ë°° í‘œì‹œ
          document.getElementById("nutritionBreakdown").innerHTML = `
            <div class="d-flex justify-content-between mb-2">
              <span>ì¼ì¼ ì¹¼ë¡œë¦¬</span>
              <span class="protein-badge">${totalCalories}kcal</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>íƒ„ìˆ˜í™”ë¬¼</span>
              <span class="protein-badge">${macros.carbs}g (${Math.round(
            scientificMealData[goal].carbRatio * 100
          )}%)</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>ë‹¨ë°±ì§ˆ</span>
              <span class="protein-badge">${macros.protein}g (${Math.round(
            scientificMealData[goal].proteinRatio * 100
          )}%)</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>ì§€ë°©</span>
              <span class="protein-badge">${macros.fat}g (${Math.round(
            scientificMealData[goal].fatRatio * 100
          )}%)</span>
            </div>
          `;

          // ì‹ì‚¬ë³„ ë¶„ë°° (ë™ì ìœ¼ë¡œ ê³„ì‚°)
          // ë¨¼ì € ì–´ë–¤ ë¼ë‹ˆë“¤ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë™ì ìœ¼ë¡œ ë¹„ìœ¨ ê³„ì‚°
          const tempAdaptedMeals = adaptMealsByPreference(
            scientificMealData[goal].meals,
            preferences
          );
          const tempFinalMeals = adjustMealsToTargetCalories(
            tempAdaptedMeals,
            totalCalories,
            totalProtein
          );

          let mealBreakdownHtml = "";
          let tempTotalProtein = 0;
          let tempTotalCalories = 0;

          // ì‹¤ì œ ì‹ë‹¨ì˜ ë¼ë‹ˆë³„ ì •ë³´ ê³„ì‚°
          for (const [mealType, mealData] of Object.entries(tempFinalMeals)) {
            const mealProtein = mealData.foods.reduce(
              (sum, food) => sum + food.protein,
              0
            );
            const mealCalories = mealData.foods.reduce((sum, food) => {
              return (
                sum +
                food.protein * 4 +
                (food.carb || 0) * 4 +
                (food.fat || 0) * 9
              );
            }, 0);

            tempTotalProtein += mealProtein;
            tempTotalCalories += mealCalories;

            mealBreakdownHtml += `
              <div class="d-flex justify-content-between mb-2">
                <span>${getMealNameKorean(mealType)}</span>
                <span class="protein-badge">${Math.round(
                  mealProtein
                )}g / ${Math.round(mealCalories)}kcal</span>
              </div>
            `;
          }

          // ì´ê³„ ì¶”ê°€
          mealBreakdownHtml += `
            <hr style="border-color: var(--border-color); margin: 0.5rem 0;">
            <div class="d-flex justify-content-between" style="font-weight: bold; color: var(--primary-red);">
              <span>ì´ê³„</span>
              <span class="protein-badge">${Math.round(
                tempTotalProtein
              )}g / ${Math.round(tempTotalCalories)}kcal</span>
            </div>
          `;

          document.getElementById("mealBreakdown").innerHTML =
            mealBreakdownHtml;

          // ê³¼í•™ì  ê¸°ë°˜ ì‹ë‹¨ í‘œì‹œ
          displayScientificMealPlans(
            goal,
            totalProtein,
            preferences,
            totalCalories,
            macros
          );
          // ì‹¤ì œ êµ¬ì„±ëœ ì‹ë‹¨ ë°ì´í„°ë¥¼ ì „ë‹¬
          const finalMeals = adjustMealsToTargetCalories(
            adaptMealsByPreference(scientificMealData[goal].meals, preferences),
            totalCalories,
            totalProtein
          );
          displayIngredientSummary(finalMeals);
        }

        function displayScientificMealPlans(
          goal,
          totalProtein,
          preferences,
          totalCalories,
          macros
        ) {
          const mealPlansSection = document.getElementById("mealPlansSection");
          const mealPlans = document.getElementById("mealPlans");

          // ê³¼í•™ì  ê¸°ë°˜ ì‹ë‹¨ ê°€ì ¸ì˜¤ê¸°
          let baseMeals = scientificMealData[goal].meals;

          // ì„ í˜¸ë„ì— ë”°ë¥¸ ì‹ë‹¨ ì¡°ì •
          let adaptedMeals = adaptMealsByPreference(baseMeals, preferences);

          // ğŸ”¥ ëª©í‘œ ì¹¼ë¡œë¦¬ì— ë§ì¶° ì‹ë‹¨ ì–‘ ì¡°ì • (í•µì‹¬!)
          adaptedMeals = adjustMealsToTargetCalories(
            adaptedMeals,
            totalCalories,
            totalProtein
          );

          let mealTotalProtein = 0;
          let mealTotalCarb = 0;
          let mealTotalFat = 0;
          let mealTotalCalories = 0;
          let html = "";

          // ì´ ì˜ì–‘ì†Œ ê³„ì‚° (ì¡°ì •ëœ ì‹ë‹¨ ê¸°ì¤€)
          for (const mealData of Object.values(adaptedMeals)) {
            mealTotalProtein += mealData.foods.reduce(
              (sum, food) => sum + food.protein,
              0
            );
            mealTotalCarb += mealData.foods.reduce(
              (sum, food) => sum + (food.carb || 0),
              0
            );
            mealTotalFat += mealData.foods.reduce(
              (sum, food) => sum + (food.fat || 0),
              0
            );
          }
          mealTotalCalories =
            mealTotalProtein * 4 + mealTotalCarb * 4 + mealTotalFat * 9;

          // ì„ í˜¸ë„ ë° ê³¼í•™ì  ë°ì´í„° í‘œì‹œ
          const preferenceText = preferences
            .map((p) => {
              return p === "meat"
                ? "ìœ¡ë¥˜"
                : p === "seafood"
                ? "í•´ì‚°ë¬¼"
                : "ì‹ë¬¼ì„±";
            })
            .join(", ");

          const goalData = scientificMealData[goal];

          // ì¹¼ë¡œë¦¬ ë‹¬ì„±ë¥  ê³„ì‚° ë° ìƒ‰ìƒ ê²°ì •
          const achievementRate = Math.round(
            (mealTotalCalories / totalCalories) * 100
          );
          const achievementColor =
            Math.abs(achievementRate - 100) <= 5 ? "#28a745" : "#ffc107";

          html += `<div class="input-card text-center mb-4" style="font-size:1.1rem; font-weight:bold; color:var(--primary-red); border:2px solid var(--primary-red);">
            <h5 style="color: var(--primary-red); margin-bottom: 1rem;">ğŸ“Š ê³¼í•™ì  ë¶„ì„ ê²°ê³¼</h5>
            <div class="row text-center">
              <div class="col-md-3 mb-2">
                <strong>ëª©í‘œ:</strong><br>
                <span style="color: #fff;">${getGoalKorean(goal)}</span>
              </div>
              <div class="col-md-3 mb-2">
                <strong>ì„ í˜¸ì‹í’ˆ:</strong><br>
                <span style="color: #fff;">${preferenceText}</span>
              </div>
              <div class="col-md-3 mb-2">
                <strong>íƒ„ë‹¨ì§€ ë¹„ìœ¨:</strong><br>
                <span style="color: #fff;">${Math.round(
                  goalData.carbRatio * 100
                )}:${Math.round(goalData.proteinRatio * 100)}:${Math.round(
            goalData.fatRatio * 100
          )}</span>
              </div>
              <div class="col-md-3 mb-2">
                <strong>ì´ ë¼ë‹ˆìˆ˜:</strong><br>
                <span style="color: #fff;">${
                  Object.keys(adaptedMeals).length
                }ë¼</span>
              </div>
            </div>
            <hr style="border-color: var(--border-color); margin: 1rem 0;">
            <div class="row text-center">
              <div class="col-md-4">
                <strong>ëª©í‘œ ì¹¼ë¡œë¦¬:</strong><br>
                <span style='font-size:1.4rem; color: var(--primary-red);'>${totalCalories}kcal</span>
              </div>
              <div class="col-md-4">
                <strong>ì‹ë‹¨ ì¹¼ë¡œë¦¬:</strong><br>
                <span style='font-size:1.4rem; color: #fff;'>${Math.round(
                  mealTotalCalories
                )}kcal</span>
              </div>
              <div class="col-md-4">
                <strong>ë‹¬ì„±ë¥ :</strong><br>
                <span style='font-size:1.4rem; color: ${achievementColor}; font-weight: bold;'>
                  ${achievementRate}% âœ…
                </span>
              </div>
            </div>
            <hr style="border-color: var(--border-color); margin: 1rem 0;">
            <div class="row text-center">
              <div class="col-md-4">
                <strong>ì‹ë‹¨ ë‹¨ë°±ì§ˆ:</strong><br>
                <span style='font-size:1.3rem; color: #fff;'>${mealTotalProtein.toFixed(
                  1
                )}g</span><br>
                <small style="color: #ccc;">ëª©í‘œ: ${totalProtein}g</small>
              </div>
              <div class="col-md-4">
                <strong>ì‹ë‹¨ íƒ„ìˆ˜í™”ë¬¼:</strong><br>
                <span style='font-size:1.3rem; color: #fff;'>${mealTotalCarb.toFixed(
                  1
                )}g</span><br>
                <small style="color: #ccc;">ëª©í‘œ: ${macros.carbs}g</small>
              </div>
              <div class="col-md-4">
                <strong>ì‹ë‹¨ ì§€ë°©:</strong><br>
                <span style='font-size:1.3rem; color: #fff;'>${mealTotalFat.toFixed(
                  1
                )}g</span><br>
                <small style="color: #ccc;">ëª©í‘œ: ${macros.fat}g</small>
              </div>
            </div>
          </div>`;

          html += '<div class="row">';
          for (const [mealType, mealData] of Object.entries(adaptedMeals)) {
            const mealProtein = mealData.foods.reduce(
              (sum, food) => sum + food.protein,
              0
            );
            const mealCarb = mealData.foods.reduce(
              (sum, food) => sum + (food.carb || 0),
              0
            );
            const mealFat = mealData.foods.reduce(
              (sum, food) => sum + (food.fat || 0),
              0
            );
            const mealCalories = mealProtein * 4 + mealCarb * 4 + mealFat * 9;

            html += `
              <div class="col-md-6 mb-4">
                <div class="meal-card">
                  <h5 class="meal-title">${mealData.name}</h5>
                  <div class="mb-3">
            `;
            mealData.foods.forEach((food) => {
              const link = getCommerceLink(food.name);
              html += `
                <div class="food-item">
                  <span><a href="${link}" target="_blank" style="color:inherit; text-decoration:underline dotted;">${food.name}</a> (${food.amount})</span>
                  <span class="protein-badge">${food.protein}gë‹¨ë°±ì§ˆ</span>
                </div>
              `;
            });
            html += `
                  </div>
                  <div class="text-center" style="background: rgba(220, 38, 38, 0.1); padding: 10px; border-radius: 10px;">
                    <div style="margin-bottom: 5px;">
                      <strong style="color: var(--primary-red);">ë‹¨ë°±ì§ˆ: ${mealProtein.toFixed(
                        1
                      )}g</strong> | 
                      <span>íƒ„ìˆ˜í™”ë¬¼: ${mealCarb.toFixed(1)}g</span> | 
                      <span>ì§€ë°©: ${mealFat.toFixed(1)}g</span>
                    </div>
                    <div style="color: var(--primary-red); font-weight: bold; font-size: 1.1rem;">
                      ğŸ”¥ ${getMealNameKorean(mealType)} ì¹¼ë¡œë¦¬: ${Math.round(
              mealCalories
            )}kcal
                    </div>
                  </div>
                </div>
              </div>
            `;
          }
          html += "</div>";

          mealPlans.innerHTML = html;
          mealPlansSection.style.display = "block";
        }

        function getDefaultMealTemplate(goal) {
          // ê¸°ë³¸ ì‹ë‹¨ í…œí”Œë¦¿ (ëª¨ë“  ì¢…ë¥˜ í¬í•¨)
          const defaultTemplates = {
            bulkup: {
              breakfast: {
                name: "ê³ ë‹¨ë°± ì•„ì¹¨ì‹ì‚¬",
                foods: [
                  { name: "ê³„ë€", amount: "3ê°œ", protein: 19.5, carb: 1.5 },
                  { name: "ê·€ë¦¬", amount: "60g", protein: 10.1, carb: 38 },
                  { name: "ìš°ìœ ", amount: "250ml", protein: 8.5, carb: 12 },
                ],
              },
              lunch: {
                name: "ë²Œí¬ì—… ì ì‹¬",
                foods: [
                  { name: "ë‹­ê°€ìŠ´ì‚´", amount: "200g", protein: 62.0, carb: 0 },
                  { name: "í˜„ë¯¸", amount: "100g", protein: 7.9, carb: 23 },
                  { name: "ë¸Œë¡œì½œë¦¬", amount: "100g", protein: 2.8, carb: 7 },
                ],
              },
              dinner: {
                name: "ë²Œí¬ì—… ì €ë…",
                foods: [
                  { name: "ì—°ì–´", amount: "180g", protein: 45.0, carb: 0 },
                  { name: "ê³ êµ¬ë§ˆ", amount: "150g", protein: 3.0, carb: 30 },
                  { name: "ì‹œê¸ˆì¹˜", amount: "100g", protein: 2.9, carb: 2 },
                ],
              },
              snack: {
                name: "ë²Œí¬ì—… ê°„ì‹",
                foods: [
                  {
                    name: "ì›¨ì´ í”„ë¡œí‹´",
                    amount: "30g",
                    protein: 24.0,
                    carb: 3,
                  },
                  { name: "ë°”ë‚˜ë‚˜", amount: "1ê°œ", protein: 1.1, carb: 23 },
                ],
              },
            },
          };
          return defaultTemplates[goal] || defaultTemplates.bulkup;
        }

        function displayProteinChart() {
          const proteinFoods = [
            { name: "ë‹­ê°€ìŠ´ì‚´", protein: 31.0, category: "ìœ¡ë¥˜" },
            { name: "ì°¸ì¹˜", protein: 28.0, category: "í•´ì‚°ë¬¼" },
            { name: "ê³„ë€", protein: 13.0, category: "ìœ ì œí’ˆ" },
            { name: "ì›¨ì´ í”„ë¡œí‹´", protein: 80.0, category: "ë³´ì¶©ì œ" },
            { name: "ë‘ë¶€", protein: 8.0, category: "ì½©ë¥˜" },
            { name: "ê·¸ë¦­ìš”ê±°íŠ¸", protein: 10.0, category: "ìœ ì œí’ˆ" },
            { name: "ì—°ì–´", protein: 25.0, category: "í•´ì‚°ë¬¼" },
            { name: "ì†Œê³ ê¸°", protein: 26.0, category: "ìœ¡ë¥˜" },
          ];

          const proteinChart = document.getElementById("proteinChart");
          const proteinChartSection = document.getElementById(
            "proteinChartSection"
          );
          let html = "";

          proteinFoods.forEach((food) => {
            html += `
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="meal-card text-center">
                  <h6 class="meal-title">${food.name}</h6>
                  <div class="protein-amount" style="font-size: 1.5rem;">${food.protein}g</div>
                  <small class="text-muted">100gë‹¹</small>
                  <div class="mt-2">
                    <span class="badge bg-secondary">${food.category}</span>
                  </div>
                </div>
              </div>
            `;
          });

          proteinChart.innerHTML = html;
          proteinChartSection.style.display = "block";
        }

        function displayIngredientSummary(goal, preferences) {
          const summaryDiv = document.getElementById("ingredientSummary");
          if (!summaryDiv) return;

          // ì„ í˜¸ë„ì— ë”°ë¥¸ ì¶”ì²œ ì‹ì¬ë£Œ í‘œì‹œ
          let ingredients = [];
          if (preferences.includes("meat")) {
            ingredients.push("ë‹­ê°€ìŠ´ì‚´", "ì†Œê³ ê¸°", "ê³„ë€");
          }
          if (preferences.includes("seafood")) {
            ingredients.push("ì—°ì–´", "ì°¸ì¹˜", "ìƒˆìš°");
          }
          if (preferences.includes("plant")) {
            ingredients.push("ë‘ë¶€", "ë Œí‹¸ì½©", "í€´ë…¸ì•„", "ì•„ëª¬ë“œ");
          }

          let html =
            '<div class="input-card" style="margin-top:1.5rem; text-align:center;">';
          html +=
            '<h5 class="mb-3"><i class="fas fa-shopping-cart text-danger"></i> ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‹ì¬ë£Œ</h5>';
          html += '<div class="d-flex flex-wrap justify-content-center gap-2">';

          ingredients.forEach((ingredient) => {
            const link = getCommerceLink(ingredient);
            html += `<a href="${link}" target="_blank" class="badge bg-dark border border-danger text-danger px-3 py-2" style="font-size:1rem; text-decoration:none;">${ingredient}</a>`;
          });

          html += "</div></div>";
          summaryDiv.innerHTML = html;
          summaryDiv.style.display = "block";
        }

        function getCommerceLink(foodName) {
          return `https://www.coupang.com/np/search?component=&q=${encodeURIComponent(
            foodName
          )}&channel=user`;
        }

        // ê²°ê³¼ ìº¡ì²˜ í•¨ìˆ˜ (ì™„ì „í•œ ì‹ë‹¨í‘œ ìº¡ì²˜)
        window.captureResult = function () {
          if (!lastCalculationResult) {
            alert("ë¨¼ì € ë‹¨ë°±ì§ˆ ê³„ì‚°ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.");
            return;
          }

          // ìº¡ì²˜í•  ì‹ë‹¨í‘œ ì»¨í…Œì´ë„ˆ ìƒì„±
          const captureContainer = document.createElement("div");
          captureContainer.style.background =
            "linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%)";
          captureContainer.style.padding = "30px";
          captureContainer.style.borderRadius = "20px";
          captureContainer.style.color = "#f8f9fa";
          captureContainer.style.fontFamily = "Arial, sans-serif";
          captureContainer.style.width = "800px";
          captureContainer.style.margin = "0 auto";

          // í—¤ë” ì˜ì—­
          const headerDiv = document.createElement("div");
          headerDiv.innerHTML = `
            <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #dc2626; padding-bottom: 20px;">
              <h2 style="color: #dc2626; margin: 0; font-size: 2.5rem;">
                <i class="fas fa-dumbbell"></i> mealStack
              </h2>
              <h3 style="color: #fff; margin: 10px 0 0 0; font-size: 1.8rem;">ë§ì¶¤í˜• ì‹ë‹¨í‘œ</h3>
              <p style="color: #ccc; margin: 5px 0 0 0; font-size: 1rem;">
                ê³¼í•™ì  ê·¼ê±° ê¸°ë°˜ ê°œì¸ë³„ ë§ì¶¤ ì˜ì–‘ ê³„íšì„œ
              </p>
            </div>
          `;
          captureContainer.appendChild(headerDiv);

          // ê°œì¸ ì •ë³´ ì˜ì—­
          const goalKorean = getGoalKorean(lastCalculationResult.goal);
          const preferenceText = lastCalculationResult.preferences
            ? lastCalculationResult.preferences
                .map((p) =>
                  p === "meat" ? "ìœ¡ë¥˜" : p === "seafood" ? "í•´ì‚°ë¬¼" : "ì‹ë¬¼ì„±"
                )
                .join(", ")
            : "ì „ì²´";

          const personalInfoDiv = document.createElement("div");
          personalInfoDiv.innerHTML = `
            <div style="background: #2d2d2d; border: 2px solid #dc2626; border-radius: 15px; padding: 20px; margin-bottom: 25px;">
              <h4 style="color: #dc2626; margin-bottom: 15px; text-align: center;">ğŸ“Š ê°œì¸ ë¶„ì„ ê²°ê³¼</h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                <div>
                  <strong style="color: #dc2626;">ì²´í˜• ëª©í‘œ:</strong><br>
                  <span style="color: #fff; font-size: 1.1rem;">${goalKorean}</span>
                </div>
                <div>
                  <strong style="color: #dc2626;">ì„ í˜¸ ì‹í’ˆ:</strong><br>
                  <span style="color: #fff; font-size: 1.1rem;">${preferenceText}</span>
                </div>
                <div>
                  <strong style="color: #dc2626;">ë¼ë‹ˆ êµ¬ì„±:</strong><br>
                  <span style="color: #fff; font-size: 1.1rem;">${
                    document.querySelectorAll(".meal-card").length
                  }ë¼ ì‹ë‹¨</span>
                </div>
              </div>
              <hr style="border-color: #404040; margin: 15px 0;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center;">
                <div>
                  <strong style="color: #dc2626;">ì¼ì¼ ëª©í‘œ ë‹¨ë°±ì§ˆ:</strong><br>
                  <span style="color: #fff; font-size: 1.3rem; font-weight: bold;">${
                    lastCalculationResult.protein
                  }g</span>
                </div>
                <div>
                  <strong style="color: #dc2626;">ì¼ì¼ ëª©í‘œ ì¹¼ë¡œë¦¬:</strong><br>
                  <span style="color: #fff; font-size: 1.3rem; font-weight: bold;">${
                    lastCalculationResult.calories || "ê³„ì‚°ëœ"
                  }kcal</span>
                </div>
              </div>
            </div>
          `;
          captureContainer.appendChild(personalInfoDiv);

          // ì‹ë‹¨í‘œ ì˜ì—­ (í˜„ì¬ í‘œì‹œëœ ì‹ë‹¨ì„ ê¸°ë°˜ìœ¼ë¡œ)
          const currentMealPlans = document.getElementById("mealPlans");
          if (currentMealPlans && currentMealPlans.innerHTML) {
            const mealTableDiv = document.createElement("div");
            mealTableDiv.innerHTML = `
              <h4 style="color: #dc2626; margin-bottom: 20px; text-align: center;">
                ğŸ½ï¸ ì˜¤ëŠ˜ì˜ ë§ì¶¤ ì‹ë‹¨í‘œ
              </h4>
            `;

            // í˜„ì¬ ì‹ë‹¨ ë°ì´í„° ë³µì‚¬ ë° ìŠ¤íƒ€ì¼ ì¡°ì •
            const clonedMeals = currentMealPlans.cloneNode(true);

            // ìŠ¤íƒ€ì¼ ì¡°ì •
            clonedMeals.style.color = "#f8f9fa";
            const mealCards = clonedMeals.querySelectorAll(".meal-card");
            mealCards.forEach((card) => {
              card.style.background = "#2d2d2d";
              card.style.border = "1px solid #404040";
              card.style.borderRadius = "10px";
              card.style.padding = "15px";
              card.style.marginBottom = "15px";
            });

            const mealTitles = clonedMeals.querySelectorAll(".meal-title");
            mealTitles.forEach((title) => {
              title.style.color = "#dc2626";
              title.style.marginBottom = "10px";
            });

            const proteinBadges =
              clonedMeals.querySelectorAll(".protein-badge");
            proteinBadges.forEach((badge) => {
              badge.style.background = "#dc2626";
              badge.style.color = "white";
              badge.style.padding = "3px 8px";
              badge.style.borderRadius = "10px";
              badge.style.fontSize = "0.8rem";
            });

            mealTableDiv.appendChild(clonedMeals);
            captureContainer.appendChild(mealTableDiv);
          }

          // ì˜ì–‘ ì •ë³´ ìš”ì•½
          if (lastCalculationResult.macros) {
            const nutritionSummaryDiv = document.createElement("div");

            // ì‹¤ì œ ì‹ë‹¨ ì˜ì–‘ì†Œ ê³„ì‚° (í˜„ì¬ í‘œì‹œëœ ì‹ë‹¨ ê¸°ë°˜)
            const currentMealCards = document.querySelectorAll(".meal-card");
            let actualProtein = 0;
            let actualCarbs = 0;
            let actualFat = 0;
            let actualCalories = 0;

            currentMealCards.forEach((card) => {
              const nutritionText =
                card.querySelector(
                  '[style*="background: rgba(220, 38, 38, 0.1)"]'
                )?.textContent || "";
              const proteinMatch =
                nutritionText.match(/ë‹¨ë°±ì§ˆ:\s*(\d+\.?\d*)g/);
              const carbMatch = nutritionText.match(/íƒ„ìˆ˜í™”ë¬¼:\s*(\d+\.?\d*)g/);
              const fatMatch = nutritionText.match(/ì§€ë°©:\s*(\d+\.?\d*)g/);
              const calorieMatch = nutritionText.match(/(\d+)kcal/);

              if (proteinMatch) actualProtein += parseFloat(proteinMatch[1]);
              if (carbMatch) actualCarbs += parseFloat(carbMatch[1]);
              if (fatMatch) actualFat += parseFloat(fatMatch[1]);
              if (calorieMatch) actualCalories += parseInt(calorieMatch[1]);
            });

            nutritionSummaryDiv.innerHTML = `
              <div style="background: #2d2d2d; border: 1px solid #404040; border-radius: 15px; padding: 20px; margin-top: 20px;">
                <h4 style="color: #dc2626; margin-bottom: 15px; text-align: center;">ğŸ“ˆ ìµœì¢… ì˜ì–‘ì†Œ ë‹¬ì„±ë„</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                  <div style="text-align: center;">
                    <h5 style="color: #dc2626; margin-bottom: 10px;">ğŸ¯ ëª©í‘œ ì˜ì–‘ì†Œ</h5>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                      <div><strong>ì¹¼ë¡œë¦¬:</strong> ${
                        lastCalculationResult.calories
                      }kcal</div>
                      <div><strong>ë‹¨ë°±ì§ˆ:</strong> ${
                        lastCalculationResult.protein
                      }g</div>
                      <div><strong>íƒ„ìˆ˜í™”ë¬¼:</strong> ${
                        lastCalculationResult.macros.carbs
                      }g</div>
                      <div><strong>ì§€ë°©:</strong> ${
                        lastCalculationResult.macros.fat
                      }g</div>
                    </div>
                  </div>
                  <div style="text-align: center;">
                    <h5 style="color: #dc2626; margin-bottom: 10px;">âœ… ì‹¤ì œ ì‹ë‹¨</h5>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                      <div><strong>ì¹¼ë¡œë¦¬:</strong> ${Math.round(
                        actualCalories
                      )}kcal</div>
                      <div><strong>ë‹¨ë°±ì§ˆ:</strong> ${actualProtein.toFixed(
                        1
                      )}g</div>
                      <div><strong>íƒ„ìˆ˜í™”ë¬¼:</strong> ${actualCarbs.toFixed(
                        1
                      )}g</div>
                      <div><strong>ì§€ë°©:</strong> ${actualFat.toFixed(1)}g</div>
                    </div>
                  </div>
                </div>
                <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #404040;">
                  <div style="color: #28a745; font-weight: bold;">
                    ğŸ‰ ì¹¼ë¡œë¦¬ ë‹¬ì„±ë¥ : ${Math.round(
                      (actualCalories / lastCalculationResult.calories) * 100
                    )}%
                  </div>
                </div>
              </div>
            `;
            captureContainer.appendChild(nutritionSummaryDiv);
          }

          // í‘¸í„° ì˜ì—­
          const footerDiv = document.createElement("div");
          footerDiv.innerHTML = `
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #404040;">
              <p style="margin: 0; color: #ccc; font-size: 0.9rem;">
                ìƒì„±ì¼ì‹œ: ${new Date().toLocaleDateString(
                  "ko-KR"
                )} ${new Date().toLocaleTimeString("ko-KR")}
              </p>
              <p style="margin: 5px 0 0 0; color: #dc2626; font-weight: bold;">
                mealStack.kr - ë‹¹ì‹ ì˜ ê±´ê°•í•œ ë³€í™”ë¥¼ ì‘ì›í•©ë‹ˆë‹¤ ğŸ’ª
              </p>
            </div>
          `;
          captureContainer.appendChild(footerDiv);

          // ì„ì‹œë¡œ bodyì— ì¶”ê°€ (í™”ë©´ ë°–ì— ë°°ì¹˜)
          captureContainer.style.position = "absolute";
          captureContainer.style.left = "-9999px";
          document.body.appendChild(captureContainer);

          html2canvas(captureContainer, {
            backgroundColor: "#1a1a1a",
            scale: 2,
            useCORS: true,
            width: 800,
            height: captureContainer.offsetHeight,
            logging: false,
          })
            .then(function (canvas) {
              // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
              const link = document.createElement("a");
              const today = new Date();
              const dateStr =
                today.getFullYear() +
                "ë…„" +
                (today.getMonth() + 1) +
                "ì›”" +
                today.getDate() +
                "ì¼";
              link.download = `mealStack_${goalKorean}_ì‹ë‹¨í‘œ_${dateStr}.png`;
              link.href = canvas.toDataURL("image/png");
              link.click();

              // ì„ì‹œ ìš”ì†Œ ì œê±°
              document.body.removeChild(captureContainer);

              // ì„±ê³µ ë©”ì‹œì§€
              alert(
                "ğŸ“¸ ì‹ë‹¨í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì–¸ì œë“ ì§€ í™•ì¸í•˜ê³  ë”°ë¼í•˜ì„¸ìš”! ğŸ’ª"
              );
            })
            .catch(function (error) {
              console.error("ìº¡ì²˜ ì˜¤ë¥˜:", error);
              document.body.removeChild(captureContainer);
              alert("ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            });
        };

        function getGoalKorean(goal) {
          const goalMap = {
            bulkup: "ë²Œí¬ì—… (ê·¼ìœ¡ ì¦ê°€)",
            lean_bulkup: "ë¦°ë²Œí¬ì—… (ê¹”ë”í•œ ì¦ëŸ‰)",
            cutting: "ì»·íŒ… (ì²´ì§€ë°© ê°ì†Œ)",
            maintain: "ìœ ì§€ (í˜„ìƒ ìœ ì§€)",
          };
          return goalMap[goal] || goal;
        }

        function getCommerceLink(foodName) {
          return `https://www.coupang.com/np/search?component=&q=${encodeURIComponent(
            foodName
          )}&channel=user`;
        }

        function displayIngredientSummary(goal, preferences) {
          const summaryDiv = document.getElementById("ingredientSummary");
          if (!summaryDiv) return;

          // ì„ í˜¸ë„ì— ë”°ë¥¸ ì¶”ì²œ ì‹ì¬ë£Œ í‘œì‹œ
          let ingredients = [];
          if (preferences.includes("meat")) {
            ingredients.push("ë‹­ê°€ìŠ´ì‚´", "ì†Œê³ ê¸°", "ê³„ë€");
          }
          if (preferences.includes("seafood")) {
            ingredients.push("ì—°ì–´", "ì°¸ì¹˜", "ìƒˆìš°");
          }
          if (preferences.includes("plant")) {
            ingredients.push("ë‘ë¶€", "ë Œí‹¸ì½©", "í€´ë…¸ì•„", "ì•„ëª¬ë“œ");
          }

          // ê¸°ë³¸ ì¶”ì²œ ì‹ì¬ë£Œ
          ingredients.push("í˜„ë¯¸", "ê³ êµ¬ë§ˆ", "ë¸Œë¡œì½œë¦¬", "ì‹œê¸ˆì¹˜", "ì˜¤íŠ¸ë°€");

          let html =
            '<div class="input-card" style="margin-top:1.5rem; text-align:center;">';
          html +=
            '<h5 class="mb-3"><i class="fas fa-shopping-cart text-danger"></i> ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‹ì¬ë£Œ</h5>';
          html += '<div class="d-flex flex-wrap justify-content-center gap-2">';

          // ì¤‘ë³µ ì œê±°
          const uniqueIngredients = [...new Set(ingredients)];

          uniqueIngredients.forEach((ingredient) => {
            const link = getCommerceLink(ingredient);
            html += `<a href="${link}" target="_blank" class="badge bg-dark border border-danger text-danger px-3 py-2" style="font-size:1rem; text-decoration:none;">${ingredient}</a>`;
          });

          html += "</div></div>";
          summaryDiv.innerHTML = html;
          summaryDiv.style.display = "block";
        }

        // ê²°ê³¼ ê³µìœ  í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
        window.shareResult = function () {
          if (!lastCalculationResult) return;

          const goalKorean = getGoalKorean(lastCalculationResult.goal);
          const preferenceText = lastCalculationResult.preferences
            ? lastCalculationResult.preferences
                .map((p) =>
                  p === "meat" ? "ìœ¡ë¥˜" : p === "seafood" ? "í•´ì‚°ë¬¼" : "ì‹ë¬¼ì„±"
                )
                .join(", ")
            : "ì „ì²´";

          const shareText = `ğŸ”¥ ë‚˜ì˜ ë§ì¶¤ ë‹¨ë°±ì§ˆ ê³„ì‚° ê²°ê³¼!

ğŸ’ª ì¼ì¼ ê¶Œì¥ ë‹¨ë°±ì§ˆ: ${lastCalculationResult.protein}g
ğŸ¯ ëª©í‘œ: ${goalKorean}
ğŸ½ï¸ ì„ í˜¸ ì‹í’ˆ: ${preferenceText}
ğŸ“Š ì¹¼ë¡œë¦¬: ${lastCalculationResult.calories || "ê³„ì‚°ëœ"}kcal

ê³¼í•™ì  ê·¼ê±° ê¸°ë°˜ ë§ì¶¤ ì‹ë‹¨ê¹Œì§€!
mealStackì—ì„œ 3ì´ˆ ë§Œì— ê³„ì‚°í•´ë³´ì„¸ìš”!
ğŸ‘‡ ì§€ê¸ˆ ë°”ë¡œ ì²´í—˜`;

          if (navigator.share) {
            navigator.share({
              title: "ğŸ¥— mealStack ë§ì¶¤ ì‹ë‹¨ ê²°ê³¼",
              text: shareText,
              url: window.location.href,
            });
          } else {
            // í´ë¦½ë³´ë“œì— ë³µì‚¬
            navigator.clipboard
              .writeText(shareText + "\n" + window.location.href)
              .then(() => {
                alert(
                  "ğŸ“‹ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nSNSë‚˜ ë©”ì‹ ì €ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”."
                );
              })
              .catch(() => {
                // í´ë¦½ë³´ë“œ ì‹¤íŒ¨ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ ìƒì„±
                const textArea = document.createElement("textarea");
                textArea.value = shareText + "\n" + window.location.href;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                alert("ğŸ“‹ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
              });
          }
        };

        window.switchLanguage = function () {
          alert("ì˜ì–´ ë²„ì „ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤!");
        };

        window.switchLanguage = function () {
          alert("ì˜ì–´ ë²„ì „ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤!");
        };

        // êµ¬ë… í¼ ì²˜ë¦¬
        document
          .getElementById("subscriptionForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            if (!lastCalculationResult) {
              alert('"ê³„ì‚° ì‹œì‘í•˜ê¸°"ë¥¼ ë¨¼ì € í•´ë³´ì„¸ìš”.');
              return;
            }

            const email = document.getElementById("emailInput").value;
            const submitButton = document.getElementById("submitButton");

            if (!email) {
              alert("ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
            }

            submitButton.disabled = true;
            submitButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ì „ì†¡ ì¤‘...`;

            const payload = {
              email: email,
              protein: lastCalculationResult.protein,
              goal: lastCalculationResult.goal,
              description: lastCalculationResult.description,
              preferences: lastCalculationResult.preferences,
              calories: lastCalculationResult.calories,
              weight: lastCalculationResult.weight,
              activity: lastCalculationResult.activity,
            };

            // Google Apps Script URL (ì‹¤ì œ ë°°í¬ëœ URLë¡œ êµì²´ í•„ìš”)
            const GAPS_URL =
              "https://script.google.com/macros/s/AKfycbyCd5mEK6qTeRAuETWiRawvH2qSRgAPhuy7itkbnlFe-aGjn5irenmJk4ynO47ZKkP7/exec";

            fetch(GAPS_URL, {
              method: "POST",
              mode: "no-cors",
              cache: "no-cache",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            })
              .then(() => {
                showSubscriptionSuccess();
              })
              .catch((error) => {
                console.error("Error:", error);
                showSubscriptionSuccess();
              })
              .finally(() => {
                submitButton.disabled = false;
                submitButton.innerHTML = `<i class="fas fa-bell"></i> ì˜ˆì•½ ì•ˆë‚´ ë°›ì•„ë³´ê¸°`;
              });
          });

        function showSubscriptionSuccess() {
          const successMessage = document.getElementById(
            "subscriptionSuccessMessage"
          );
          const emailInput = document.getElementById("emailInput");

          successMessage.style.display = "block";
          emailInput.value = "";

          setTimeout(() => {
            successMessage.style.display = "none";
          }, 3000);
        }
      });
    </script>
  </body>
</html>
